!function(){"use strict";angular.module("mqtt",["ngRoute","ngAnimate","ui.bootstrap","toastr"])}(),function(){"use strict";function t(t,e,n){t.html5Mode({enabled:!0,requireBase:!1}),n.defaults.cache=!0,e.when("/",{templateUrl:"view/users/users.html",controller:"usersCtrl as Ctrl"}).when("/login",{templateUrl:"view/login/login.html",controller:"loginCtrl as Ctrl"}).when("/topics",{templateUrl:"view/topics/topics.html",controller:"topicsCtrl as Ctrl"}).when("/send",{templateUrl:"view/send/send.html",controller:"sendCtrl as Ctrl"}).when("/messages",{templateUrl:"view/messages/messages.html",controller:"messagesCtrl as Ctrl"}).otherwise("/")}t.$inject=["$locationProvider","$routeProvider","$httpProvider"],angular.module("mqtt").config(t)}(),function(){"use strict";angular.module("mqtt").constant("mqttConstants",{API_SERVER_URL:"http://localhost:8888",API_CONNECT_URL:"/connect",API_DISCONNECT_URL:"/disconnect",API_PUBLISH_URL:"/publish",API_SUBSCRIBE_URL:"/subscribe",API_UNSUBSCRIBE_URL:"/unsubscribe",API_MESSAGES_URL:"/getmessages",API_TOPICS_URL:"/gettopics",API_USERS_LIST_URL:"/users",API_USERS_REMOVE_URL:"/users/remove",API_CONNECTION_URL:"/check"})}(),function(){"use strict";function t(t,e,n,o,s,i,r){function c(s){t.post(e.API_SERVER_URL+e.API_CONNECT_URL,s).then(function(t){return t.data.length<1?void o.error("Login failed!"):(n.path("/topics"),i.setSessionData(s),void o.success("Successfully logged in!",t))},function(t){o.error(t.data,"Oops some error here!")})["catch"](function(t){})}function a(s){angular.fromJson(sessionStorage.getItem("mqttSession"));t.post(e.API_SERVER_URL+e.API_DISCONNECT_URL,s).then(function(t){n.path("/"),o.success("Successfully logged out!",t),r.auth=!1},function(t){o.error(t.data,"Oops some error here!")})["catch"](function(t){console.log(t)})}function u(n){var i=s.defer();return t.post(e.API_SERVER_URL+e.API_MESSAGES_URL,n).then(function(t){i.resolve(t)},function(t){o.error(t.data,"Oops some error in getting messages!")})["catch"](function(t){}),i.promise}function l(n){t.post(e.API_SERVER_URL+e.API_PUBLISH_URL,n).then(function(t){o.success("Successfully published!",t)},function(t){o.error(t.data,"Oops some error here!")})["catch"](function(t){})}function f(n){var i=s.defer();return t.post(e.API_SERVER_URL+e.API_TOPICS_URL,n).then(function(t){i.resolve(t)},function(t){console.log(t),o.error(t.data,"Oops some error here!")})["catch"](function(t){}),i.promise}function p(n){var i=s.defer();return t.post(e.API_SERVER_URL+e.API_SUBSCRIBE_URL,n).then(function(t){i.resolve(t),t.data.length?o.success("Successfully subscribed!"):o.error("Subscribe error!")})["catch"](function(t){console.log(t)}),i.promise}function m(n){var i=s.defer();return t.post(e.API_SERVER_URL+e.API_UNSUBSCRIBE_URL,n).then(function(t){i.resolve(t),o.success("Successfully unsubscribed!")})["catch"](function(t){console.log(t)}),i.promise}function d(){var n=s.defer();return t.post(e.API_SERVER_URL+e.API_USERS_LIST_URL).then(function(t){n.resolve(t.data)})["catch"](function(t){console.log(t)}),n.promise}function h(n){var o=s.defer();return t.post(e.API_SERVER_URL+e.API_USERS_REMOVE_URL,n).then(function(t){o.resolve(t.data)})["catch"](function(t){console.log(t)}),o.promise}function g(o){var i=s.defer();return t.post(e.API_SERVER_URL+e.API_CONNECTION_URL,o).then(function(t){i.resolve(t.data)})["catch"](function(t){n.path("/")}),i.promise}return{connect:c,getMessages:u,publish:l,getTopics:f,subscribe:p,unsubscribe:m,disconnect:a,getUsers:d,removeUser:h,checkConnection:g}}t.$inject=["$http","mqttConstants","$location","toastr","$q","sessionFactory","$rootScope"],angular.module("mqtt").factory("dataFactory",t)}(),function(){"use strict";function t(t,e,n){function o(){return"undefined"==typeof a&&(a=angular.fromJson(sessionStorage.getItem("mqttSession"))),"undefined"==typeof a||null==a?(n.auth=!1,void e.path("/")):(n.auth=!0,a)}function s(t){sessionStorage.setItem("mqttSession",angular.toJson(t)),"undefined"==typeof t&&sessionStorage.removeItem("mqttSession"),a=t,t&&addUserToStorage(t),n.auth=!0}function i(t){u=[];for(var e=0;e<t.length;e++){for(var n=0,o=0;o<u.length;o++)u[o].topic==t[e].subscribtion.topic&&(n=1);1!=n&&u.push(t[e].subscribtion),n=0}}function r(t){var e=u.indexOf(t);u.splice(e,1)}function c(){return u}return{getSessionData:o,setSessionData:s,pushTopic:i,popTopic:r,getTopics:c};var a,u}t.$inject=["toastr","$location","$rootScope"],angular.module("mqtt").factory("sessionFactory",t)}(),function(){"use strict";function t(t,e,n,o){function s(){var t=o.getSessionData();n.disconnect(t)}function i(){}var r=this;r.exit=s,t.route=e.$$url,i()}t.$inject=["$scope","$location","dataFactory","sessionFactory"],angular.module("mqtt").controller("indexCtrl",t)}(),function(){"use strict";function t(t,e){function n(e){for(var n=0;n<s.types.length;n++)s.protocolType==s.types[n].id&&(e.type=s.types[n]);e.unique=e.clientID+Math.random().toString(18).substr(2,16),t.connect(e)}function o(){}var s=this;s.protocolType=null,s.types=[{name:"MQTT",id:1},{name:"SN",id:2},{name:"COAP",id:3},{name:"AMQP",id:4},{name:"WEBSOCKETS",id:5}],s.login={isClean:!1,will:{retain:!1},secure:!1,certificate:null,privateKey:null},s.connect=n,s.login={certificate:null,clientID:"123",host:"broker.iotbroker.cloud",isClean:!1,keepalive:"10",password:"galina1988",port:"1883",privateKey:null,type:{name:"MQTT",id:1,$$hashKey:"object:5"},username:"yulian.oifa@mobius-software.com"},o()}t.$inject=["dataFactory","sessionFactory"],angular.module("mqtt").controller("loginCtrl",t)}(),function(){"use strict";function t(t,e,n,o,s,i){function r(){t.getMessages({directions:["in","out"],topics:p,username:f.username,clientID:f.clientID,type:f.type,unique:f.unique}).then(function(t){l.messages=t.data})["catch"](function(t){n.error(t,"Oops some error here!")})}function c(){var n=i.defer();return t.getTopics({username:f.username,clientID:f.clientID,type:f.type,unique:f.unique}).then(function(t){t.data.length>0&&e.pushTopic(t.data),n.resolve()}),n.promise}function a(){f=e.getSessionData(),c().then(function(){var t=e.getTopics();if(t)for(var n=0;n<t.length;n++)p.push(t[n].topic);r()}),"undefined"!=typeof f&&(u=setInterval(r,2e3))}var u,l=this,f={},p=[];l.messages=[],s.$on("$routeChangeStart",function(){clearInterval(u)}),a()}t.$inject=["dataFactory","sessionFactory","toastr","$location","$rootScope","$q"],angular.module("mqtt").controller("messagesCtrl",t)}(),function(){"use strict";function t(t,e){function n(e){s.message.username=s.sessionData.username,s.message.clientID=s.sessionData.clientID,s.message.type=s.sessionData.type,s.message.unique=s.sessionData.unique,t.publish(s.message),s.message={retain:!1,isDupe:!1}}function o(){s.sessionData=e.getSessionData()}var s=this;s.sessionData=e.getSessionData(),s.message,s.publish=n,s.message={retain:!1,isDupe:!1},o()}t.$inject=["dataFactory","sessionFactory"],angular.module("mqtt").controller("sendCtrl",t)}(),function(){"use strict";function t(t,e,n){function o(){setTimeout(function(){document.documentElement.scrollTop=document.documentElement.offsetHeight},200)}function s(t){"undefined"!=typeof t&&e.unsubscribe({topics:[t.topic],username:a.username,clientID:a.clientID,type:a.type,topic:[t],unique:a.unique}).then(function(t){setTimeout(function(){r()},2e3),document.body.click()})}function i(){"undefined"==typeof u.newItem.qos&&3!=u.sessionData.type.id&&4!=u.sessionData.type.id||"undefined"==typeof u.newItem.topic||e.subscribe({topics:[u.newItem],username:a.username,clientID:a.clientID,type:a.type,unique:a.unique}).then(function(t){setTimeout(function(){r()},1e3),u.newItem={},document.body.click()})}function r(){e.getTopics({username:a.username,clientID:a.clientID,type:a.type}).then(function(t){t.data.length>0&&n.pushTopic(t.data),u.topics=[],u.topics=n.getTopics(),0==t.data.length&&(u.topics=[])})}function c(){a=n.getSessionData(),a&&r()}var a,u=this;u.sessionData=n.getSessionData(),u.topics=[],u.newItem={},u.deleteItem=s,u.addItem=i,u.scrollBottom=o,t.popover={templateUrl:"/view/topics/modal.html",title:"Add new topic"},t.deletePopover={templateUrl:"/view/topics/popoverDelete.html",title:"Unsubscribe from topic?"},c()}t.$inject=["$scope","dataFactory","sessionFactory"],angular.module("mqtt").controller("topicsCtrl",t)}(),function(){"use strict";function t(t,e,n,o,s){function i(){function i(){var t=s.getSessionData();e.checkConnection({unique:t.unique}).then(function(o){o||e.disconnect(t),c.timer=n(i,2e3)},function(n){e.disconnect(t)})}function r(){c.route=t.$$url,c.sessionData=s.getSessionData()}var c=this;c.sessionData={},c.auth=o.auth,r(),i(),o.$on("$routeChangeSuccess",function(){c.route=t.$$url,n.cancel(c.timer)}),o.$watch(function(){return c.auth=o.auth},function(){c.auth=o.auth})}function r(){}return{bindToController:!0,controller:i,controllerAs:"Ctrl",link:r,restrict:"AE",scope:{},templateUrl:"assets/directives/navigation.html"}}t.$inject=["$location","dataFactory","$timeout","$rootScope","sessionFactory"],angular.module("mqtt").directive("navigation",t)}(),function(){"use strict";function t(t,e,n){function o(){e.getUsers().then(function(t){r.userslist=t})}function s(t){e.removeUser(t).then(function(t){o()})}function i(t){t.unique=t.clientID+Math.random().toString(18).substr(2,16),e.connect(t)}var r=this;r.userslist=[],r.removeUserFromList=s,r.connect=i,o()}t.$inject=["$scope","dataFactory","sessionFactory"],angular.module("mqtt").controller("usersCtrl",t)}();