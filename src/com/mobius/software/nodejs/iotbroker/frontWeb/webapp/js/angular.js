!function(){"use strict";angular.module("mqtt",["ngRoute","ngAnimate","ui.bootstrap","toastr"])}(),function(){"use strict";function t(t,e,n){t.html5Mode({enabled:!0,requireBase:!1}),n.defaults.cache=!0,e.when("/",{templateUrl:"view/login/login.html",controller:"loginCtrl as Ctrl"}).when("/topics",{templateUrl:"view/topics/topics.html",controller:"topicsCtrl as Ctrl"}).when("/send",{templateUrl:"view/send/send.html",controller:"sendCtrl as Ctrl"}).when("/messages",{templateUrl:"view/messages/messages.html",controller:"messagesCtrl as Ctrl"}).otherwise("/")}t.$inject=["$locationProvider","$routeProvider","$httpProvider"],angular.module("mqtt").config(t)}(),function(){"use strict";angular.module("mqtt").constant("mqttConstants",{API_SERVER_URL:"http://localhost:8888",API_CONNECT_URL:"/connect",API_DISCONNECT_URL:"/disconnect",API_PUBLISH_URL:"/publish",API_SUBSCRIBE_URL:"/subscribe",API_UNSUBSCRIBE_URL:"/unsubscribe",API_MESSAGES_URL:"/getmessages",API_TOPICS_URL:"/gettopics"})}(),function(){"use strict";function t(t,e,n,o,s,i,c){function r(s){console.log(s),t.post(e.API_SERVER_URL+e.API_CONNECT_URL,s).then(function(t){return t.data.length<1&&3!=s.type.id?void o.error("Login failed!"):(n.path("/topics"),i.setSessionData(s),void o.success("Successfully logged in!",t))},function(t){console.log(t),o.error(t.data,"Oops some error here!")})["catch"](function(t){})}function a(s){t.post(e.API_SERVER_URL+e.API_DISCONNECT_URL,s).then(function(t){n.path("/"),o.success("Successfully logged out!",t),c.auth=!1},function(t){o.error(t.data,"Oops some error here!")})["catch"](function(t){console.log(t)})}function u(n){var i=s.defer();return t.post(e.API_SERVER_URL+e.API_MESSAGES_URL,n).then(function(t){i.resolve(t)},function(t){o.error(t.data,"Oops some error in getting messages!")})["catch"](function(t){}),i.promise}function l(n){t.post(e.API_SERVER_URL+e.API_PUBLISH_URL,n).then(function(t){o.success("Successfully published!",t)},function(t){o.error(t.data,"Oops some error here!")})["catch"](function(t){})}function p(n){var i=s.defer();return t.post(e.API_SERVER_URL+e.API_TOPICS_URL,n).then(function(t){i.resolve(t)},function(t){console.log(t),o.error(t.data,"Oops some error here!")})["catch"](function(t){}),i.promise}function f(n){console.log(n);var i=s.defer();return t.post(e.API_SERVER_URL+e.API_SUBSCRIBE_URL,n).then(function(t){i.resolve(t),console.log(t),o.success("Successfully subscribed!")})["catch"](function(t){console.log(t)}),i.promise}function m(n){console.log(n);var i=s.defer();return t.post(e.API_SERVER_URL+e.API_UNSUBSCRIBE_URL,n).then(function(t){i.resolve(t),console.log(t),o.success("Successfully unsubscribed!")})["catch"](function(t){console.log(t)}),i.promise}return{connect:r,getMessages:u,publish:l,getTopics:p,subscribe:f,unsubscribe:m,disconnect:a}}t.$inject=["$http","mqttConstants","$location","toastr","$q","sessionFactory","$rootScope"],angular.module("mqtt").factory("dataFactory",t)}(),function(){"use strict";function t(t,e,n){function o(){return"undefined"==typeof a&&(a=angular.fromJson(sessionStorage.getItem("mqttSession"))),"undefined"==typeof a||null==a?(n.auth=!1,t.warning("First please log in!"),void e.path("/")):(n.auth=!0,a)}function s(t){sessionStorage.setItem("mqttSession",angular.toJson(t)),"undefined"==typeof t&&sessionStorage.removeItem("mqttSession"),a=t,n.auth=!0}function i(t){u=[];for(var e=0;e<t.length;e++){for(var n=0,o=0;o<u.length;o++)u[o].topic==t[e].subscribtion.topic&&(n=1);1!=n&&u.push(t[e].subscribtion),n=0}}function c(t){var e=u.indexOf(t);u.splice(e,1)}function r(){return u}return{getSessionData:o,setSessionData:s,pushTopic:i,popTopic:c,getTopics:r};var a,u}t.$inject=["toastr","$location","$rootScope"],angular.module("mqtt").factory("sessionFactory",t)}(),function(){"use strict";function t(t,e,n,o){function s(){var t=o.getSessionData();n.disconnect(t)}function i(){r=o.getSessionData()}var c=this,r={};c.exit=s,t.route=e.$$url,i()}t.$inject=["$scope","$location","dataFactory","sessionFactory"],angular.module("mqtt").controller("indexCtrl",t)}(),function(){"use strict";function t(t,e){function n(){for(var e=0;e<s.types.length;e++)s.protocolType==s.types[e].id&&(s.protocolType=s.types[e]);s.login.type=s.protocolType,t.connect(s.login)}function o(){}var s=this;s.protocolType=null,s.types=[{name:"MQTT",id:1},{name:"SN",id:2},{name:"COAP",id:3},{name:"AMQP",id:4}],s.login={isClean:!1,will:{retain:!1}},s.connect=n,o()}t.$inject=["dataFactory","sessionFactory"],angular.module("mqtt").controller("loginCtrl",t)}(),function(){"use strict";function t(t,e,n,o,s,i){function c(){t.getMessages({directions:["in","out"],topics:f,username:p.username,clientID:p.clientID,type:p.type}).then(function(t){l.messages=t.data})["catch"](function(t){n.error(t,"Oops some error here!")})}function r(){var n=i.defer();return t.getTopics({username:p.username,clientID:p.clientID,type:p.type}).then(function(t){t.data.length>0&&e.pushTopic(t.data),n.resolve()}),n.promise}function a(){p=e.getSessionData(),r().then(function(){var t=e.getTopics();if(t)for(var n=0;n<t.length;n++)f.push(t[n].topic);c()}),"undefined"!=typeof p&&(u=setInterval(c,2e3))}var u,l=this,p={},f=[];l.messages=[],s.$on("$routeChangeStart",function(){clearInterval(u)}),a()}t.$inject=["dataFactory","sessionFactory","toastr","$location","$rootScope","$q"],angular.module("mqtt").controller("messagesCtrl",t)}(),function(){"use strict";function t(t,e){function n(e){s.message.username=s.sessionData.username,s.message.clientID=s.sessionData.clientID,s.message.type=s.sessionData.type,t.publish(s.message)}function o(){s.sessionData=e.getSessionData()}var s=this;s.sessionData=e.getSessionData(),s.message,s.publish=n,s.message={retain:!1,isDupe:!1},o()}t.$inject=["dataFactory","sessionFactory"],angular.module("mqtt").controller("sendCtrl",t)}(),function(){"use strict";function t(t,e,n){function o(t){"undefined"!=typeof t.item&&e.unsubscribe({topics:[t.item.topic],username:r.username,clientID:r.clientID,type:r.type,topic:[t.item]}).then(function(t){setTimeout(function(){i()},2e3),document.body.click()})}function s(){"undefined"==typeof a.newItem.qos&&3!=a.sessionData.type.id||"undefined"==typeof a.newItem.topic||e.subscribe({topics:[a.newItem],username:r.username,clientID:r.clientID,type:r.type}).then(function(t){setTimeout(function(){i()},1e3),a.newItem={},document.body.click()})}function i(){e.getTopics({username:r.username,clientID:r.clientID,type:r.type}).then(function(t){t.data.length>0&&n.pushTopic(t.data),a.topics=[],a.topics=n.getTopics()})}function c(){r=n.getSessionData(),r&&i()}var r,a=this;a.sessionData=n.getSessionData(),a.topics=[],a.newItem={},a.deleteItem=o,a.addItem=s,t.popover={templateUrl:"/view/topics/modal.html",title:"Add new topic"},t.deletePopover={templateUrl:"/view/topics/popoverDelete.html",title:"Unsubscribe from topic?"},c()}t.$inject=["$scope","dataFactory","sessionFactory"],angular.module("mqtt").controller("topicsCtrl",t)}(),function(){"use strict";function t(t,e,n){function o(){function o(){s.route=t.$$url,s.sessionData=n.getSessionData()}var s=this;s.sessionData={},s.auth=e.auth,o(),e.$on("$routeChangeSuccess",function(){s.route=t.$$url}),e.$watch(function(){return s.auth=e.auth},function(){s.auth=e.auth})}function s(){}return{bindToController:!0,controller:o,controllerAs:"Ctrl",link:s,restrict:"AE",scope:{},templateUrl:"assets/directives/navigation.html"}}t.$inject=["$location","$rootScope","sessionFactory"],angular.module("mqtt").directive("navigation",t)}();