{"version":3,"sources":["view/messages/messagesCtrl.js"],"names":[],"mappings":"AAAA,CAAC,WAAW;IACR;;IAEA,aAAa,UAAU,CAAC,eAAe,kBAAkB,UAAU,aAAa,cAAc;IAC9F;SACK,OAAO;SACP,WAAW,gBAAgB;;;IAGhC,SAAS,aAAa,aAAa,gBAAgB,QAAQ,WAAW,YAAY,IAAI;QAClF,IAAI,KAAK;QACT,IAAI,cAAc;QAClB,IAAI;QACJ,IAAI,SAAS;QACb,GAAG,WAAW;;;QAGd,SAAS,cAAc;YACnB,YAAY,YAAY;gBACpB,YAAY,CAAC,MAAM;gBACnB,QAAQ;gBACR,UAAU,YAAY;gBACtB,UAAU,YAAY;gBACtB,MAAM,YAAY;gBAClB,SAAS,YAAY;eACtB,KAAK,SAAS,MAAM;gBACnB,GAAG,WAAW,KAAK;eACpB,MAAM,SAAS,MAAM;gBACpB,OAAO,MAAM,MAAM;;;;QAI3B,WAAW,IAAI,qBAAqB,WAAW;YAC3C,cAAc;;;QAGlB,SAAS,YAAY;YACjB,IAAI,MAAM,GAAG;YACb,YAAY,UAAU;gBAClB,UAAU,YAAY;gBACtB,UAAU,YAAY;gBACtB,MAAM,YAAY;gBAClB,SAAS,YAAY;eACtB,KAAK,SAAS,MAAM;gBACnB,IAAI,KAAK,KAAK,SAAS,GAAG;oBACtB,eAAe,UAAU,KAAK;;gBAElC,IAAI;;YAER,OAAO,IAAI;;;QAGf;;QAEA,SAAS,OAAO;YACZ,cAAc,eAAe;YAC7B,YAAY,KAAK,WAAW;gBACxB,IAAI,YAAY,eAAe;gBAC/B,GAAG;gBACH,KAAK,IAAI,IAAI,GAAG,IAAI,UAAU,QAAQ,KAAK;oBACvC,OAAO,KAAK,UAAU,GAAG;;gBAE7B;;YAEJ,IAAI,OAAO,eAAe,aAAa;gBACnC,QAAQ,YAAY,aAAa;;;;;;KAM5C","sourcesContent":["(function() {\r\n    'use strict';\r\n\r\n    messagesCtrl.$inject = [\"dataFactory\", \"sessionFactory\", \"toastr\", \"$location\", \"$rootScope\", \"$q\"];\r\n    angular\r\n        .module('mqtt')\r\n        .controller('messagesCtrl', messagesCtrl)\r\n\r\n    /** @ngInject */\r\n    function messagesCtrl(dataFactory, sessionFactory, toastr, $location, $rootScope, $q) {\r\n        var vm = this;\r\n        var sessionData = {};\r\n        var timer;\r\n        var topics = [];\r\n        vm.messages = [];\r\n\r\n\r\n        function getMessages() {\r\n            dataFactory.getMessages({\r\n                directions: [\"in\", \"out\"],\r\n                topics: topics,\r\n                username: sessionData.username,\r\n                clientID: sessionData.clientID,\r\n                type: sessionData.type,\r\n                unique:  sessionData.unique\r\n            }).then(function(data) {\r\n                vm.messages = data.data;\r\n            }).catch(function(data) {\r\n                toastr.error(data, 'Oops some error here!');\r\n            });\r\n        }\r\n\r\n        $rootScope.$on(\"$routeChangeStart\", function() {\r\n            clearInterval(timer);\r\n        })\r\n\r\n        function getTopics() {\r\n            var def = $q.defer();\r\n            dataFactory.getTopics({\r\n                username: sessionData.username,\r\n                clientID: sessionData.clientID,\r\n                type: sessionData.type,\r\n                unique:  sessionData.unique\r\n            }).then(function(data) {\r\n                if (data.data.length > 0) {\r\n                    sessionFactory.pushTopic(data.data);\r\n                }\r\n                def.resolve();\r\n            });\r\n            return def.promise;\r\n        }\r\n\r\n        init();\r\n\r\n        function init() {\r\n            sessionData = sessionFactory.getSessionData();\r\n            getTopics().then(function() {\r\n                var allTopics = sessionFactory.getTopics();\r\n                if(allTopics)\r\n                for (var i = 0; i < allTopics.length; i++) {\r\n                    topics.push(allTopics[i].topic);\r\n                }\r\n                getMessages();\r\n            });\r\n            if (typeof sessionData != 'undefined') {\r\n                timer = setInterval(getMessages, 2000);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n}());"],"file":"../../../view/messages/messagesCtrl.js"}