{"version":3,"sources":["view/topics/topicsCtrl.js"],"names":[],"mappings":"AAAA,CAAC,WAAW;IACR;;IAEA,WAAW,UAAU,CAAC,UAAU,eAAe;IAC/C;SACK,OAAO;SACP,WAAW,cAAc;;;IAG9B,SAAS,WAAW,QAAQ,aAAa,gBAAgB;QACrD,IAAI,KAAK;QACT,IAAI;QACJ,GAAG,cAAc,eAAe;QAChC,GAAG,SAAS;QACZ,GAAG,UAAU;QACb,GAAG,aAAa;QAChB,GAAG,UAAU;;;QAGb,OAAO,UAAU;YACb,aAAa;YACb,OAAO;;;QAGX,OAAO,gBAAgB;YACnB,aAAa;YACb,OAAO;;;QAGX;;QAEA,SAAS,WAAW,QAAQ;;YAExB,IAAI,OAAO,OAAO,QAAQ,aAAa;YACvC,YAAY,YAAY;gBACpB,QAAQ,CAAC,OAAO,KAAK;gBACrB,UAAU,YAAY;gBACtB,UAAU,YAAY;gBACtB,MAAM,YAAY;gBAClB,OAAO,CAAC,OAAO;eAChB,KAAK,SAAS,MAAM;gBACnB,WAAW,WAAW;oBAClB;;mBAED;gBACH,SAAS,KAAK;;;;QAItB,SAAS,UAAU;;YAEf,IAAI,CAAC,OAAO,GAAG,QAAQ,OAAO,eAAe,GAAG,YAAY,KAAK,MAAM,MAAM,OAAO,GAAG,QAAQ,SAAS,aAAa;YACrH,YAAY,UAAU;gBAClB,QAAQ,CAAC,GAAG;gBACZ,UAAU,YAAY;gBACtB,UAAU,YAAY;gBACtB,MAAM,YAAY;eACnB,KAAK,SAAS,MAAM;gBACnB,WAAW,WAAW;oBAClB;mBACD;gBACH,GAAG,UAAU;gBACb,SAAS,KAAK;;;;QAItB,SAAS,YAAY;aAChB,YAAY,UAAU;gBACnB,UAAU,YAAY;gBACtB,UAAU,YAAY;gBACtB,MAAM,YAAY;eACnB,KAAK,SAAS,MAAM;gBACnB,IAAI,KAAK,KAAK,SAAS,GAAG;oBACtB,eAAe,UAAU,KAAK;;gBAElC,GAAG,SAAS;gBACZ,GAAG,SAAS,eAAe;;;;QAInC,SAAS,OAAO;YACZ,cAAc,eAAe;YAC7B,IAAI,CAAC,CAAC;gBACF;;;;;KAKX","sourcesContent":["(function() {\r\n    'use strict';\r\n\r\n    topicsCtrl.$inject = [\"$scope\", \"dataFactory\", \"sessionFactory\"];\r\n    angular\r\n        .module('mqtt')\r\n        .controller('topicsCtrl', topicsCtrl)\r\n\r\n    /** @ngInject */\r\n    function topicsCtrl($scope, dataFactory, sessionFactory) {\r\n        var vm = this;\r\n        var sessionData;\r\n        vm.sessionData = sessionFactory.getSessionData();\r\n        vm.topics = [];\r\n        vm.newItem = {};\r\n        vm.deleteItem = deleteItem;\r\n        vm.addItem = addItem;\r\n\r\n\r\n        $scope.popover = {\r\n            templateUrl: '/view/topics/modal.html',\r\n            title: 'Add new topic'\r\n        };\r\n\r\n        $scope.deletePopover = {\r\n            templateUrl: '/view/topics/popoverDelete.html',\r\n            title: 'Unsubscribe from topic?'\r\n        };\r\n\r\n        init();\r\n\r\n        function deleteItem(params) {\r\n            // console.log(params.item);\r\n            if (typeof params.item == 'undefined') return;\r\n            dataFactory.unsubscribe({\r\n                topics: [params.item.topic],\r\n                username: sessionData.username,\r\n                clientID: sessionData.clientID,\r\n                type: sessionData.type,\r\n                topic: [params.item]    \r\n            }).then(function(data) {\r\n                setTimeout(function() {\r\n                    getTopics();\r\n                    // console.log(vm.topics);\r\n                }, 2000);\r\n                document.body.click();\r\n            });\r\n        }\r\n\r\n        function addItem() {\r\n            // console.log(vm.newItem);\r\n            if ((typeof vm.newItem.qos == 'undefined' && vm.sessionData.type.id != 3) || typeof vm.newItem.topic == 'undefined') return;\r\n            dataFactory.subscribe({\r\n                topics: [vm.newItem],\r\n                username: sessionData.username,\r\n                clientID: sessionData.clientID,\r\n                type: sessionData.type       \r\n            }).then(function(data) {\r\n                setTimeout(function() {\r\n                    getTopics();\r\n                }, 1000);\r\n                vm.newItem = {};\r\n                document.body.click();\r\n            });\r\n        }\r\n\r\n        function getTopics() {\r\n             dataFactory.getTopics({\r\n                username: sessionData.username,  \r\n                clientID: sessionData.clientID,\r\n                type: sessionData.type         \r\n            }).then(function(data) {\r\n                if (data.data.length > 0) {\r\n                    sessionFactory.pushTopic(data.data);\r\n                }\r\n                vm.topics = [];\r\n                vm.topics = sessionFactory.getTopics();\r\n            });\r\n        }\r\n\r\n        function init() {\r\n            sessionData = sessionFactory.getSessionData();\r\n            if (!!sessionData)\r\n                getTopics();\r\n        }\r\n\r\n    }\r\n\r\n}());"],"file":"../../../view/topics/topicsCtrl.js"}