{"version":3,"sources":["view/messages/messagesCtrl.js"],"names":[],"mappings":"AAAA,CAAC,WAAW;IACR;;IAEA,aAAa,UAAU,CAAC,eAAe,kBAAkB,UAAU,aAAa,cAAc;IAC9F;SACK,OAAO;SACP,WAAW,gBAAgB;;;IAGhC,SAAS,aAAa,aAAa,gBAAgB,QAAQ,WAAW,YAAY,IAAI;QAClF,IAAI,KAAK;QACT,IAAI,cAAc;QAClB,IAAI;QACJ,IAAI,SAAS;QACb,GAAG,WAAW;;;QAGd,SAAS,cAAc;;YAEnB,YAAY,YAAY;gBACpB,YAAY,CAAC,MAAM;gBACnB,QAAQ;gBACR,UAAU,YAAY;eACvB,KAAK,SAAS,MAAM;;gBAEnB,GAAG,WAAW,KAAK;eACpB,MAAM,SAAS,MAAM;gBACpB,OAAO,MAAM,MAAM;;;;QAI3B,WAAW,IAAI,qBAAqB,WAAW;YAC3C,cAAc;;;QAGlB,SAAS,YAAY;YACjB,IAAI,MAAM,GAAG;YACb,YAAY,UAAU;gBAClB,UAAU,YAAY;eACvB,KAAK,SAAS,MAAM;gBACnB,IAAI,KAAK,KAAK,SAAS,GAAG;oBACtB,eAAe,UAAU,KAAK;;gBAElC,IAAI;;YAER,OAAO,IAAI;;;QAGf;;QAEA,SAAS,OAAO;YACZ,cAAc,eAAe;YAC7B,YAAY,KAAK,WAAW;gBACxB,IAAI,YAAY,eAAe;gBAC/B,KAAK,IAAI,IAAI,GAAG,IAAI,UAAU,QAAQ,KAAK;oBACvC,OAAO,KAAK,UAAU,GAAG;;gBAE7B;;YAEJ,IAAI,OAAO,eAAe,aAAa;gBACnC,QAAQ,YAAY,aAAa;;;;;;KAM5C","sourcesContent":["(function() {\n    'use strict';\n\n    messagesCtrl.$inject = [\"dataFactory\", \"sessionFactory\", \"toastr\", \"$location\", \"$rootScope\", \"$q\"];\n    angular\n        .module('mqtt')\n        .controller('messagesCtrl', messagesCtrl)\n\n    /** @ngInject */\n    function messagesCtrl(dataFactory, sessionFactory, toastr, $location, $rootScope, $q) {\n        var vm = this;\n        var sessionData = {};\n        var timer;\n        var topics = [];\n        vm.messages = [];\n\n\n        function getMessages() {\n            // console.log(topics);\n            dataFactory.getMessages({\n                directions: [\"in\", \"out\"],\n                topics: topics,\n                username: sessionData.username\n            }).then(function(data) {\n                // console.log(data);\n                vm.messages = data.data;\n            }).catch(function(data) {\n                toastr.error(data, 'Oops some error here!');\n            });\n        }\n\n        $rootScope.$on(\"$routeChangeStart\", function() {\n            clearInterval(timer);\n        })\n\n        function getTopics() {\n            var def = $q.defer();\n            dataFactory.getTopics({\n                username: sessionData.username\n            }).then(function(data) {\n                if (data.data.length > 0) {\n                    sessionFactory.pushTopic(data.data);\n                }\n                def.resolve();\n            });\n            return def.promise;\n        }\n\n        init();\n\n        function init() {\n            sessionData = sessionFactory.getSessionData();\n            getTopics().then(function() {\n                var allTopics = sessionFactory.getTopics();\n                for (var i = 0; i < allTopics.length; i++) {\n                    topics.push(allTopics[i].topic);\n                }\n                getMessages();\n            });\n            if (typeof sessionData != 'undefined') {\n                timer = setInterval(getMessages, 2000);\n            }\n        }\n\n    }\n\n}());"],"file":"../../../view/messages/messagesCtrl.js"}